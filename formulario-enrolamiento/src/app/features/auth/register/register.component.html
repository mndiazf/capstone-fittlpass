<div class="login-overlay" *ngIf="visible" (click)="onBackdrop($event)" (keydown.escape)="close.emit()"> 
  <div class="register-container" role="dialog" aria-modal="true" (click)="$event.stopPropagation()">
    <button class="close" type="button" aria-label="Cerrar" (click)="close.emit()">✕</button>

    <!-- Formulario Izquierda -->
    <div class="form-section">
      <img src="assets/logo-gymhealth.png" alt="GymHealth" class="logo" />
      <h2 class="welcome">Completa tu registro</h2>

      <form [formGroup]="f" (ngSubmit)="submit()" novalidate>
        <!-- Fila 1: Nombre / Segundo nombre -->
        <div class="row-2">
          <div>
            <label>Nombre</label>
            <input type="text" formControlName="firstName" 
                   [class.invalid]="firstName?.touched && firstName?.invalid"/>
          </div>
          <div>
            <label>Segundo nombre</label>
            <input type="text" formControlName="middleName" />
          </div>
        </div>

        <!-- Fila 2: Apellido / Segundo apellido -->
        <div class="row-2">
          <div>
            <label>Apellido</label>
            <input type="text" formControlName="lastName"
                   [class.invalid]="lastName?.touched && lastName?.invalid"/>
          </div>
          <div>
            <label>Segundo apellido</label>
            <input type="text" formControlName="secondLastName" />
          </div>
        </div>

        <!-- Rut -->
        <div class="full">
          <label>Rut</label>
          <input type="text" formControlName="rut" placeholder="12.345.678-9"
                 [class.invalid]="rut?.touched && rut?.invalid"/>
          <small class="hint">Formato chileno con dígito verificador</small>
        </div>

        <!-- Email -->
        <div class="full">
          <label>Email</label>
          <input type="email" formControlName="email" placeholder="correo@dominio.com"
                 [class.invalid]="email?.touched && email?.invalid"/>
        </div>

        <!-- Teléfono -->
        <div class="full">
          <label>Teléfono</label>
          <input type="tel" formControlName="phone" placeholder="+56 9 1234 5678"
                 [class.invalid]="phone?.touched && phone?.invalid"/>
        </div>

        <!-- Contraseñas -->
        <div class="full" formGroupName="passwordGroup">
          <div class="full">
            <label>Contraseña</label>
            <input type="password" formControlName="password"
                   [class.invalid]="(passGroup?.get('password')?.touched && passGroup?.get('password')?.invalid) || passGroup?.errors?.['mismatch']"/>
          </div>
          <div class="full">
            <label>Repite tu contraseña</label>
            <input type="password" formControlName="confirm"
                   [class.invalid]="(passGroup?.get('confirm')?.touched && passGroup?.get('confirm')?.invalid) || passGroup?.errors?.['mismatch']"/>
          </div>

          <div class="error full" *ngIf="passGroup?.touched && passGroup?.errors?.['mismatch']">
            Las contraseñas no coinciden
          </div>
        </div>

        <!-- Botón -->
        <div class="full">
          <button type="submit" [disabled]="f.invalid">Continuar con el pago</button>
        </div>
      </form>

      <div class="extra-links">
        <a (click)="toLogin.emit()">¿Ya tienes cuenta? Inicia sesión</a>
      </div>
    </div>

    <!-- Resumen Derecha -->
    <div class="summary-section" *ngIf="selectedMembership">
      <h3 class="summary-title">Resumen de compra</h3>
      
      <div class="membership-summary">
        <div class="plan-badge">{{ selectedMembership.discount }}</div>
        <h4 class="plan-name">{{ selectedMembership.name }}</h4>
        
        <div class="plan-features">
          <p class="features-title">Incluye:</p>
          <ul>
            <li *ngFor="let feature of selectedMembership.features">
              <svg viewBox="0 0 24 24">
                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
              </svg>
              {{ feature }}
            </li>
          </ul>
        </div>

        <div class="pricing-summary">
          <div class="price-row">
            <span class="label">Precio mensual:</span>
            <span class="value">{{ selectedMembership.monthlyPrice }}</span>
          </div>
          <div class="price-row total">
            <span class="label">Total:</span>
            <span class="value">{{ selectedMembership.price }}</span>
          </div>
        </div>

        <div class="security-note">
          <svg viewBox="0 0 24 24">
            <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"/>
          </svg>
          <span>Pago seguro y protegido</span>
        </div>
      </div>
    </div>
  </div>
</div>