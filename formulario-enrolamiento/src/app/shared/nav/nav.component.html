<header class="navbar" role="banner">
  <div class="navbar__inner">
    <!-- Brand -->
    <a routerLink="/" class="brand" aria-label="Ir al inicio">
      <img class="brand__logo" src="assets/logo-gymhealth.png" alt="GymHealth"/>
    </a>

    <!-- Menú central -->
    <nav class="main-nav" [class.open]="open()" role="navigation">
      <a *ngFor="let it of itemsToShow"
         [routerLink]="it.link.startsWith('/#') ? '/' : it.link"
         (click)="it.link.startsWith('/#') ? scrollToSection(it.link, $event) : null"
         routerLinkActive="active"
         [routerLinkActiveOptions]="{ exact: it.exact ?? (it.link === '/') }">
        {{ it.label }}
      </a>
    </nav>

    <!-- Acciones derecha -->
    <div class="actions">
      <ng-container *ngFor="let ac of actionsToShow">
        <!-- USER: cambia según sesion -->
        <ng-container *ngIf="ac.icon === 'user'; else otherActions">
          <ng-container *ngIf="isAuthenticated; else loginBtn">
            <!-- PERFIL CON DROPDOWN -->
            <div class="profile-dropdown">
              <button type="button"
                      class="icon-link btn-profile"
                      (click)="toggleProfileMenu()"
                      aria-label="Perfil"
                      title="Perfil">
                <svg viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-4.4 0-8 2.24-8 5v1h16v-1c0-2.76-3.6-5-8-5Z"/>
                </svg>
                <span>Perfil</span>
                <svg class="chevron" viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M7 10l5 5 5-5z"/>
                </svg>
              </button>
              
              <!-- Menú desplegable -->
              <div class="dropdown-menu" [class.open]="profileMenuOpen()">
                <a routerLink="/profile/datos" 
                   routerLinkActive="active"
                   (click)="closeProfileMenu()">
                  <svg viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
                  </svg>
                  <span>Mis Datos</span>
                </a>
              </div>
            </div>
          </ng-container>
          <ng-template #loginBtn>
            <!-- LOGIN -->
            <button type="button"
                    class="icon-link btn-login"
                    (click)="openLogin()"
                    aria-label="Login"
                    title="Login">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-4.4 0-8 2.24-8 5v1h16v-1c0-2.76-3.6-5-8-5Z"/>
              </svg>
              <span>Login</span>
            </button>
          </ng-template>
        </ng-container>

        <!-- Otros iconos -->
        <ng-template #otherActions>
          <a class="icon-link"
             [routerLink]="ac.link"
             [attr.aria-label]="ac.aria || ac.label"
             [attr.title]="ac.aria || ac.label">
            <ng-container [ngSwitch]="ac.icon">
              <svg *ngSwitchCase="'gear'" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M19.14 12.94a7.58 7.58 0 0 0 .05-.94 7.58 7.58 0 0 0-.05-.94l2.03-1.58a.5.5 0 0 0 .12-.64l-1.92-3.32a.5.5 0 0 0-.6-.22l-2.39.96a7.53 7.53 0 0 0-1.63-.94l-.36-2.54A.5.5 0 0 0 12.94 1h-3.88a.5.5 0 0 0-.49.42l-.36 2.54a7.53 7.53 0 0 0-1.63.94l-2.39-.96a.5.5 0 0 0-.6.22L.77 7.04a.5.5 0 0 0 .12.64L2.92 9.26a7.58 7.58 0 0 0-.05.94c0 .32.02.63.05.94L.89 13.72a.5.5 0 0 0-.12.64l1.92 3.32a.5.5 0 0 0 .6.22l2.39-.96c.5.38 1.05.7 1.63.94l.36 2.54a.5.5 0 0 0 .49.42h3.88a.5.5 0 0 0 .49-.42l.36-2.54c.58-.24 1.13-.56 1.63-.94l2.39.96a.5.5 0 0 0 .6-.22l1.92-3.32a.5.5 0 0 0-.12-.64ZM11 15a4 4 0 1 1 4-4 4 4 0 0 1-4 4Z"/>
              </svg>
              <svg *ngSwitchCase="'report'" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M4 3h12l4 4v14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2Zm11 1v4h4M7 19v-6h2v6H7Zm4 0v-10h2v10h-2Zm4 0v-4h2v4h-2Z"/>
              </svg>
            </ng-container>
            <span *ngIf="ac.label">{{ ac.label }}</span>
          </a>
        </ng-template>
      </ng-container>
    </div>
  </div>

  <!-- ===== MENÚ MÓVIL ===== -->
  <nav class="mobile-nav" aria-label="Menú móvil">
    <div class="mobile-bar">
      <a routerLink="/" class="m-brand" aria-label="Ir al inicio">
        <img class="m-logo" src="assets/logo-gymhealth.png" alt="GymHealth" />
      </a>
      <div class="mobile-actions">
        <button *ngIf="isAuthenticated" 
                type="button"
                class="m-profile-btn"
                [routerLink]="'/profile/datos'"
                aria-label="Mis Datos">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-4.4 0-8 2.24-8 5v1h16v-1c0-2.76-3.6-5-8-5Z"/>
          </svg>
        </button>
        <button class="m-burger" type="button" (click)="toggle()" [attr.aria-expanded]="open()" aria-label="Abrir menú">
          <span></span><span></span><span></span>
        </button>
      </div>
    </div>

    <button class="m-backdrop" [class.open]="open()" aria-hidden="true" (click)="toggle()"></button>

    <div class="mobile-sheet" [class.open]="open()">
      <a [routerLink]="'/'" (click)="scrollToSection('/', $event); toggle()" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }"><span>Inicio</span></a>
      <a (click)="scrollToSection('/#servicios', $event)" class="mobile-link"><span>Servicios</span></a>
      <a (click)="scrollToSection('/#membresias', $event)" class="mobile-link"><span>Membresías</span></a>
      <a (click)="scrollToSection('/#clases', $event)" class="mobile-link"><span>Clases</span></a>

      <!-- Login / Perfil -->
      <div class="m-actions" *ngIf="!isAuthenticated">
        <button class="btn-login" type="button"
                (click)="toggle(); openLogin()">
          <span>Login</span>
        </button>
      </div>
    </div>
  </nav>

  <!-- Modales -->
  <app-login
    [visible]="modal==='login'"
    (close)="closeModal()"
    (forgot)="openForgot()"
    (register)="openRegister()">
  </app-login>

  <app-forgot-password
    [inline]="true"
    [visible]="modal==='forgot'"
    (close)="openLogin()">
  </app-forgot-password>

  <app-register
    [visible]="modal==='register'"
    (close)="closeModal()"
    (toLogin)="openLogin()">
  </app-register>
</header>