<header class="navbar" role="banner">
  <div class="navbar__inner">
    <!-- Brand -->
    <a
      class="brand"
      aria-label="Ir al inicio"
    >
      <img class="brand__logo" src="assets/logo-gymhealth.png" alt="GymHealth"/>
    </a>

    <!-- Menú central (solo si NO está autenticado) -->
    <nav class="main-nav" [class.open]="open()" role="navigation" *ngIf="!isAuthenticated">
      <a *ngFor="let it of itemsToShow"
         [routerLink]="it.link.startsWith('/#') ? '/' : it.link"
         (click)="onItemClick(it, $event)"
         routerLinkActive="active"
         [routerLinkActiveOptions]="{ exact: it.exact ?? (it.link === '/') }">
        {{ it.label }}
      </a>
    </nav>

    <!-- Acciones derecha -->
    <div class="actions">
      <!-- Si está autenticado, solo mostrar Cerrar sesión -->
      <button *ngIf="isAuthenticated"
              type="button"
              class="icon-link btn-logout"
              (click)="logout()"
              aria-label="Cerrar sesión"
              title="Cerrar sesión">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
        </svg>
        <span>Cerrar sesión</span>
      </button>

      <!-- Si NO está autenticado, mostrar acciones normales (incluye Login) -->
      <ng-container *ngIf="!isAuthenticated">
        <ng-container *ngFor="let ac of actionsToShow">
          <ng-container *ngIf="ac.icon === 'user'; else otherActions">
            <!-- LOGIN -->
            <button type="button"
                    class="icon-link btn-login"
                    (click)="openLogin()"
                    aria-label="Login"
                    title="Login">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-4.4 0-8 2.24-8 5v1h16v-1c0-2.76-3.6-5-8-5Z"/>
              </svg>
              <span>Login</span>
            </button>
          </ng-container>

          <ng-template #otherActions>
            <a class="icon-link"
               [routerLink]="ac.link"
               [attr.aria-label]="ac.aria || ac.label"
               [attr.title]="ac.aria || ac.label">
              <span *ngIf="ac.label">{{ ac.label }}</span>
            </a>
          </ng-template>
        </ng-container>
      </ng-container>
    </div>
  </div>

  <!-- ===== MENÚ MÓVIL ===== -->
  <nav class="mobile-nav" aria-label="Menú móvil">
    <div class="mobile-bar">
      <a
        class="m-brand"
        aria-label="Ir al inicio"
        [routerLink]="'/'"
        (click)="onBrandClick($event)"
      >
        <img class="m-logo" src="assets/logo-gymhealth.png" alt="GymHealth" />
      </a>

      <div class="mobile-actions">
        <!-- Si está autenticado, solo botón de cerrar sesión -->
        <button *ngIf="isAuthenticated"
                type="button"
                class="m-profile-btn"
                (click)="logout()"
                aria-label="Cerrar sesión">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4z"/>
          </svg>
        </button>

        <!-- Burger solo si NO está autenticado (para abrir menú de secciones) -->
        <button *ngIf="!isAuthenticated"
                class="m-burger" type="button" (click)="toggle()" [attr.aria-expanded]="open()" aria-label="Abrir menú">
          <span></span><span></span><span></span>
        </button>
      </div>
    </div>

    <!-- Backdrop y sheet solo si NO está autenticado -->
    <button class="m-backdrop" *ngIf="!isAuthenticated" [class.open]="open()" aria-hidden="true" (click)="toggle()"></button>

    <div class="mobile-sheet" *ngIf="!isAuthenticated" [class.open]="open()">
      <a [routerLink]="'/'"
         (click)="onHomeClick($event); toggle()"
         routerLinkActive="active"
         [routerLinkActiveOptions]="{ exact: true }">
        <span>Inicio</span>
      </a>
      <a (click)="scrollToSection('/#servicios', $event)" class="mobile-link"><span>Servicios</span></a>
      <a (click)="scrollToSection('/#membresias', $event)" class="mobile-link"><span>Membresías</span></a>
      <a (click)="scrollToSection('/#clases', $event)" class="mobile-link"><span>Clases</span></a>

      <!-- Login -->
      <div class="m-actions">
        <button class="btn-login" type="button" (click)="toggle(); openLogin()">
          <span>Login</span>
        </button>
      </div>
    </div>
  </nav>

  <!-- Modales (solo si NO está autenticado) -->
  <app-login
    *ngIf="!isAuthenticated"
    [visible]="modal==='login'"
    (close)="closeModal()"
    (forgot)="openForgot()"
    (register)="openRegister()">
  </app-login>

  <app-forgot-password
    *ngIf="!isAuthenticated"
    [inline]="true"
    [visible]="modal==='forgot'"
    (close)="openLogin()">
  </app-forgot-password>
</header>
